<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>6&nbsp; BigQuery to APIs to Products – Global Fishing Watch documentation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Fishing-effort-and-vessel-presence.html" rel="next">
<link href="./Key-concepts.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-626149efe8f5d16e1d391ba177679bf0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./BigQuery-in-Products.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">BigQuery to APIs to Products</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Documentation Materials</a> 
        <div class="sidebar-tools-main">
    <a href="https://globalfishingwatch.org/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-house-door-fill"></i></a>
    <a href="https://github.com/GlobalFishingWatch/GFW_technical_documentation" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Home.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">GFW Data Documentation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Data-Updates.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">(PART) Data updates</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./BigQuery-datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">(PART) Big Query</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./BigQuery-Table-Reference----PIPE-3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Big Query table reference PIPE 3</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./BigQuery-Table-Reference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Big Query table reference</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Key-concepts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Big Query Key concepts</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./BigQuery-in-Products.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">BigQuery to APIs to Products</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Fishing-effort-and-vessel-presence.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">(PART) Global Fishing Watch Datasets</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Vessel-Identity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">(PART) Vessel identity</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Product-Vessel-Info-Summary-PVIS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Product Vessel Info Summary (PVIS)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Vessel-database.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Vessel database</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Vessel-info-tables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Vessel info tables</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Annual-carrier-vessel-list.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Annual carrier vessel list</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Fishing-events.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">(PART) Events</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Encounters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Encounters</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Loitering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Loitering</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Gaps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Gaps</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Anchorages-and-voyages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Anchorages, voyages and port visits</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./SAR-object-detections.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">SAR object detections</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./VMS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">VMS Data Sources</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Spatial-Regions-Sources-and-Methodology.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Spatial regions sources and methodology</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Areas-EEZ-Boundaries.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">EEZ Boundaries</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Areas-12-NM-Boundary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">12 NM Boundary</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Areas-RFMOs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">RFMOs</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Areas-FAO-Areas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">FAO Areas</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Areas-High-Seas-Pockets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">High Seas Pockets</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Areas-High-Seas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">High Seas</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Areas-Protected-Seas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Protected Seas</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Areas-WDPA-Marine-MPAs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">WDPA Marine MPAs</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Areas-HOW-TO---Do-point-in-polygon-test-in-BigQuery.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">HOW TO - Do point-in-polygon test in BigQuery (BQ) using regions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Areas-HOW-TO---Update-layer-in-pipe-regions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">HOW TO - Update layer in pipe_regions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Country-Codes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Country codes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Coverage.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Coverage</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Satellite-Timing-Offset-Table.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Satellite timing offset</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Pipeline.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">GFW Pipelines</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Wiki-Documentation-Standards.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Wiki Page Requirements</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Useful-links.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Internal materials</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Data-products-page-TEMPLATE.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Data products page template</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./training-materials-README.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">(PART) Training materials</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#gfw-apis" id="toc-gfw-apis" class="nav-link active" data-scroll-target="#gfw-apis"><span class="header-section-number">6.1</span> GFW APIs</a>
  <ul class="collapse">
  <li><a href="#current-gfw-apis" id="toc-current-gfw-apis" class="nav-link" data-scroll-target="#current-gfw-apis"><span class="header-section-number">6.1.1</span> Current GFW APIs</a></li>
  <li><a href="#products-using-legacy-apis" id="toc-products-using-legacy-apis" class="nav-link" data-scroll-target="#products-using-legacy-apis"><span class="header-section-number">6.1.2</span> Products Using Legacy APIs</a></li>
  </ul></li>
  <li><a href="#accessing-api-logic" id="toc-accessing-api-logic" class="nav-link" data-scroll-target="#accessing-api-logic"><span class="header-section-number">6.2</span> Accessing API Logic</a></li>
  <li><a href="#caveats-and-considerations" id="toc-caveats-and-considerations" class="nav-link" data-scroll-target="#caveats-and-considerations"><span class="header-section-number">6.3</span> Caveats and Considerations</a></li>
  <li><a href="#old-materials---to-be-deleted" id="toc-old-materials---to-be-deleted" class="nav-link" data-scroll-target="#old-materials---to-be-deleted"><span class="header-section-number">6.4</span> OLD MATERIALS - TO BE DELETED</a></li>
  <li><a href="#product-overview" id="toc-product-overview" class="nav-link" data-scroll-target="#product-overview"><span class="header-section-number">6.5</span> Product Overview</a></li>
  <li><a href="#carrier-vessel-portal-cvp-v0-api" id="toc-carrier-vessel-portal-cvp-v0-api" class="nav-link" data-scroll-target="#carrier-vessel-portal-cvp-v0-api"><span class="header-section-number">6.6</span> Carrier Vessel Portal (CVP) | v0 API</a></li>
  <li><a href="#api-portal-v1-api" id="toc-api-portal-v1-api" class="nav-link" data-scroll-target="#api-portal-v1-api"><span class="header-section-number">6.7</span> API Portal | v1 API</a></li>
  <li><a href="#gfw-map-v1-api" id="toc-gfw-map-v1-api" class="nav-link" data-scroll-target="#gfw-map-v1-api"><span class="header-section-number">6.8</span> GFW Map | v1 API</a></li>
  <li><a href="#marine-manager-v1-api" id="toc-marine-manager-v1-api" class="nav-link" data-scroll-target="#marine-manager-v1-api"><span class="header-section-number">6.9</span> Marine Manager | v1 API</a></li>
  <li><a href="#vessel-viewer-v1-api" id="toc-vessel-viewer-v1-api" class="nav-link" data-scroll-target="#vessel-viewer-v1-api"><span class="header-section-number">6.10</span> Vessel Viewer | v1 API</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/GlobalFishingWatch/GFW_technical_documentation/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">BigQuery to APIs to Products</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><br> The flow of data from <strong>BigQuery</strong> to <a href="https://docs.google.com/document/d/1JY0umwJ5j8qFpOb90OuaUOo43y45yExaenNWzUlbkCo/edit?tab=t.0"><strong>GFW Products</strong></a> is enabled through a set of <strong>Application Programming Interfaces (APIs)</strong>. This page documents the key APIs, the underlying queries powering them, and how they support user-facing products.</p>
<section id="gfw-apis" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="gfw-apis"><span class="header-section-number">6.1</span> GFW APIs</h2>
<section id="current-gfw-apis" class="level3" data-number="6.1.1">
<h3 data-number="6.1.1" class="anchored" data-anchor-id="current-gfw-apis"><span class="header-section-number">6.1.1</span> <a href="https://globalfishingwatch.org/our-apis/documentation#introduction">Current GFW APIs</a></h3>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 74%">
</colgroup>
<thead>
<tr class="header">
<th>API Name</th>
<th>Used In Products</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Map Visualization (4Wings API)</strong></td>
<td>API Portal, Map, Marine Manager</td>
</tr>
<tr class="even">
<td><strong>Vessels API</strong></td>
<td>API Portal, Map, Vessel Profile, Marine Manager, <code>gfwR</code>, Python SDK</td>
</tr>
<tr class="odd">
<td><strong>Events API</strong></td>
<td>API Portal, Map, Vessel Profile, Marine Manager, <code>gfwR</code>, Python SDK</td>
</tr>
<tr class="even">
<td><strong>Insights API</strong></td>
<td>API Portal, Map, Vessel Profile, Marine Manager</td>
</tr>
<tr class="odd">
<td><strong>Datasets API</strong></td>
<td>API Portal, Map</td>
</tr>
<tr class="even">
<td><strong>Bulk Download API</strong></td>
<td>API Portal</td>
</tr>
</tbody>
</table>
</section>
<section id="products-using-legacy-apis" class="level3" data-number="6.1.2">
<h3 data-number="6.1.2" class="anchored" data-anchor-id="products-using-legacy-apis"><span class="header-section-number">6.1.2</span> Products Using Legacy APIs</h3>
<p>Some older products are still using legacy APIs:</p>
<ul>
<li><strong>Legacy CVP</strong></li>
<li><strong>Vessel Profile Prototype</strong></li>
</ul>
</section>
</section>
<section id="accessing-api-logic" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="accessing-api-logic"><span class="header-section-number">6.2</span> Accessing API Logic</h2>
<p>API query logic is maintained in <a href="#">this central hub</a>.</p>
<p>To view underlying queries and code for BigQuery tables:</p>
<ul>
<li>Open the relevant table in BigQuery.</li>
<li>Click the <strong>“Details”</strong> tab to find:
<ul>
<li>Source tables</li>
<li>(When available) links to the GitHub code that generates each table</li>
</ul></li>
</ul>
<blockquote class="blockquote">
<p>⚠️ If the logic in the API hub seems outdated or unclear, contact <strong>Gisela</strong>.</p>
</blockquote>
</section>
<section id="caveats-and-considerations" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="caveats-and-considerations"><span class="header-section-number">6.3</span> Caveats and Considerations</h2>
<p><strong>Permissions</strong></p>
<p>Access to API data may be restricted depending on your user role. Some datasets may only be available to:</p>
<ul>
<li>Internal GFW staff</li>
<li>JAC members</li>
<li>Specific partners</li>
</ul>
<p>As a result, data visible through the API can vary based on your credentials.</p>
<p><strong>Data Filters</strong></p>
<p>We’ve made our best effort to document all filters and permission scopes on each API. However, gaps may still exist.</p>
<p>If you’re uncertain about:</p>
<ul>
<li>Why data may be missing or inconsistent</li>
<li>What filters are applied</li>
</ul>
<p>Please contact <strong>Gisela</strong> for clarification.</p>
<p><br> <br> <br> <br></p>
</section>
<section id="old-materials---to-be-deleted" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="old-materials---to-be-deleted"><span class="header-section-number">6.4</span> OLD MATERIALS - TO BE DELETED</h2>
</section>
<section id="product-overview" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="product-overview"><span class="header-section-number">6.5</span> <a href="https://docs.google.com/document/d/1JY0umwJ5j8qFpOb90OuaUOo43y45yExaenNWzUlbkCo/edit">Product Overview</a></h2>
<p>This page highlights the data included in products; bigquery source tables, API code, and data restrictions applied to the data. Additionally, updates to data in products, such as changes in source data tables or changes in restrictions to the data are outlined. Resources on how to use and interact with products are linked.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>API</th>
<th>Product</th>
<th>BQ Queries</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>V0</td>
<td><a href="https://globalfishingwatch.org/carrier-vessel-portal/">CVP</a></td>
<td><a href="https://github.com/GlobalFishingWatch/pipe-carrier-portal/tree/master/assets/bigquery">V0 API Queries</a></td>
<td>The plan is to update the CVP to using the <br> same APIs as other the other products in the future.</td>
</tr>
<tr class="even">
<td>V1</td>
<td><a href="https://globalfishingwatch.org/map/">GFW Map</a>, <br> <a href="https://globalfishingwatch.org/marine-manager-portal/">Marine Manager</a>, <br> <a href="https://globalfishingwatch.org/vessel-viewer">Vessel Viewer</a>, <br> <a href="https://globalfishingwatch.org/ocean-engine/tokens/signup">API Portal</a></td>
<td><a href="https://datasets.globalfishingwatch.org/">V1 API Queries</a> <br> Username: datasets <br> Password: gfw_doc</td>
<td>There are certain filters and manipulations done to data <br> in the API which can occur outside of the BigQuery code. <br> Those nuances may eventually be updated and included <br> in the Wiki but are not currently, so be aware.</td>
</tr>
</tbody>
</table>
<p><strong>Resources</strong> + <a href="https://drive.google.com/drive/folders/1OZhFcIeSvGnCE0W6CiNBCDKxxgR8fgVT">Product Hour recordings</a> + <a href="https://github.com/GlobalFishingWatch/bigquery-documentation-wf827/blob/master/queries/published_events_unnest_auth_info.sql">Published Events with unnested authorization information example query</a></p>
</section>
<section id="carrier-vessel-portal-cvp-v0-api" class="level2" data-number="6.6">
<h2 data-number="6.6" class="anchored" data-anchor-id="carrier-vessel-portal-cvp-v0-api"><span class="header-section-number">6.6</span> <a href="https://globalfishingwatch.org/carrier-vessel-portal/">Carrier Vessel Portal (CVP)</a> | v0 API</h2>
<p>The Carrier Vessel Portal (CVP) uses publicly available data from 2017 through the present to identify potential vessel encounters and loitering events. It synthesizes fishing registry information to create a picture of potential authorizations for both carrier and fishing vessels involved in transshipment activity. The CVP is the only Product using the v0 API, although, in the future, the Product and Engineering team will look to transition the CVP to using the same API as the other Products.</p>
<p><strong>Data in the Portal</strong> + V0 API | <a href="https://github.com/GlobalFishingWatch/pipe-carrier-portal/tree/master/assets/bigquery">Current CVP queries</a> + The output of the current CVP queries can be found in BigQuery under the bin name <code>pipe_carrier_portal_production_v20220124</code></p>
<p><strong>Data Restrictions in Portal</strong> + <strong>Encounters</strong> are limited to those between carriers and fishing vessels and support and fishing vessels + <strong>Loitering events</strong> are limited to those by carrier vessels with a minimum duration of 1 hour. + <strong>Port visits</strong> are limited to Confidence 4 visits. For more information see <a href="https://github.com/GlobalFishingWatch/bigquery-documentation-wf827/wiki/Anchorages-and-voyages">Anchorages and Voyages</a> wiki + Information on <strong>vessel authorization</strong> is updated on one month lag</p>
<p><strong>Unique Features (compared to GFW Map):</strong> Authorization Data, Port visits</p>
<p><strong>Resources</strong> + <a href="https://docs.google.com/document/d/1DbUyeKvZfE_wEsBNcJE61HBLixLPqm3t5fFn5FxJv0A/edit#">CVP Product Hour notes, resources, and demo recording</a> + <a href="https://globalfishingwatch.org/help-faqs/">CVP FAQs</a> + <a href="https://globalfishingwatch.org/carrier-vessel-portal-disclaimers/">CVP Disclaimers</a> + <a href="https://globalfishingwatch.org/authorization-records/">Authorization Records</a> + <a href="https://globalfishingwatch.org/tutorials/">GFW Product Tutorials</a></p>
<p><strong>Upcoming/Future Plans</strong> + If the CVP is maintained as a standalone product, then queries will be updated and V1 API will be used</p>
<p><strong>Updates</strong> + Feb 15, 2022: CVP data updated on a 3 day lag rather than monthly update. CVP encounters code now pulls encounters from published_events_encounters and identified carrier, support, and fishing vessel by_year tables. + Nov 2021: v0 API updated port visits and loitering events on CVP to pull from pipe_production_vYYYYMMDD published events ports and loitering tables. Port visits in the published events table are limited to confidence = 4. The loitering events logic has been changed to group points at seg_id level and not ssvid, and thus the number of loitering events in some areas increased noticeably due to some long loitering events now being grouped as many small loitering events. The CVP encounters query <br></p>
</section>
<section id="api-portal-v1-api" class="level2" data-number="6.7">
<h2 data-number="6.7" class="anchored" data-anchor-id="api-portal-v1-api"><span class="header-section-number">6.7</span> <a href="https://globalfishingwatch.org/ocean-engine/tokens/signup">API Portal</a> | v1 API</h2>
<p>GFW’s API’s provide a set of instructions for software to access select GFW data and information. An API retrieves and delivers data to both front-end and back-end applications.</p>
<p>The GFW API Portal makes it feasible for our data to be hosted on the maps of collaborating organizations (like SeaVision). The API Portal launched on July 19th, 2022. A wrapper package in R, named <code>gfwr</code>, also launched alongside the API Portal, and allows individuals to call data from the API Portal directly into R.</p>
<p><strong>APIs Resources</strong> + <a href="https://docs.google.com/document/d/1CWVXqZpyutLOUO5YyACBzftUiEIxug7EPd8PXsadEE8/edit?usp=sharing">Intro APIs</a> - slide deck for introduction to API’s <br> + <a href="https://docs.google.com/presentation/d/1E6h00EUEEr2HRAAXm3rJUwrF6NcM52t8S0n_yinJbqw/edit#slide=id.gc69f7383cc_0_1092">GFW Ocean-Engine: APIs and Blueprints, June 2021</a> - introduction to GFW’s APIs + R package to access API Portal: A <a href="https://github.com/GlobalFishingWatch/gfwr">wrapper in R</a> has been developed so that GFW’s API Portal data can be easily used in R. The package named <code>gfwr</code> can now be accessed. <a href="https://globalfishingwatch.slack.com/archives/C026FKDJGMT/p1654885678794689">Slack thread.</a></p>
<p><strong>Upcoming/Future Plans</strong> + TBD <br></p>
<p><strong>Updates</strong> + July 19, 2022: API Portal Launch! gfwr R package release <br></p>
</section>
<section id="gfw-map-v1-api" class="level2" data-number="6.8">
<h2 data-number="6.8" class="anchored" data-anchor-id="gfw-map-v1-api"><span class="header-section-number">6.8</span> <a href="https://globalfishingwatch.org/map/">GFW Map</a> | v1 API</h2>
<p>The Global Fishing Watch map is the “main” GFW product. The map merges multiple types of vessel tracking data to provide a view of global human activity at sea, including fishing activity, encounters between vessels, night light vessel detection and vessel presence. The map includes global fishing activity from 2012 to the present from more than 65,000 commercial fishing vessels that are responsible for a significant part of global seafood catch. Users can search for vessels, filter activity by flag State or time period, identify port visits and view encounters between vessels. The map also allows anyone to upload and overlay their own data, download aggregated fishing reports of activity from custom areas, and save and share what is on the current view.</p>
<p><strong>Data in the Portal</strong> + V1 API | <a href="https://datasets.globalfishingwatch.org/">V1 API Queries</a> (Username: datasets | Password: gfw_doc). + Within the V1 API Queries are the BQ source datasets.</p>
<p><strong>Resources</strong> + <a href="https://www.loom.com/share/dd1daa446295450aa5bdc0bba9e124ba">LATEST demo of map - July 2022</a> + <a href="https://docs.google.com/presentation/d/1aexIaw_Gw_LpBVJf2O1elapq-wZ5iAu5q8aJcg3yXrA/edit?usp=sharing">Map 3.0 GFW Internal Slide Deck</a> - highly recommend. Succinct but informative overview of target users, new functionalities, and examples of how to interact with map. + <a href="https://docs.google.com/document/d/18Thsx0ebYzyvm8JZoKm6LtrrfOfI6WZHcnG3FyAdLrE/edit">GFW Map Launch Materials</a> + <a href="https://globalfishingwatch.org/tutorials/">GFW Product Tutorials</a></p>
<p><strong>Internal Features (GFW Staff Only)</strong> + <a href="https://www.loom.com/share/99594dec8de24887917ce02cae95629c">Load BigQuery data directly into GFW Map</a> - when logged into GFW Map with GFW email press ‘b’ 7 times to get to interface to run BigQuery + <a href="https://globalfishingwatch.slack.com/archives/G8V3UUFK8/p1660133391345519">Vessel Groups</a></p>
<p><strong>Upcoming/Future Plans</strong> + Sept 2022: Vessel groups (public access); vessel gaps + TBD: <a href="https://docs.google.com/presentation/d/1NFLXiET5w6QYrPiQfAviJEMt0rqI8TR-_fRPDYyIDNo/edit?usp=sharing">layer on map with all Ports</a></p>
<p><strong>Updates</strong> + [internal only] Aug 10 2022: Vessel groups. <a href="https://globalfishingwatch.slack.com/archives/G8V3UUFK8/p1660133391345519">Slack thread.</a> + June 8th 2022: SAR layer launched on Map. <a href="https://globalfishingwatch.slack.com/archives/G8V3UUFK8/p1654781549803069">Slack thread.</a> + [internal only] Dec 23 2021: Functionality to load bigquery data directly into GFW map added + Dec 2021: Upload point files as reference layer functionality added + Oct 18 2021: GFW legacy map officially removed from GFW website + July 15 2021: GFW Map launched. Previous version of map will be available as a legacy map until Oct 18 2021 at https://globalfishingwatch.org/legacy-map <br></p>
</section>
<section id="marine-manager-v1-api" class="level2" data-number="6.9">
<h2 data-number="6.9" class="anchored" data-anchor-id="marine-manager-v1-api"><span class="header-section-number">6.9</span> <a href="https://globalfishingwatch.org/marine-manager-portal/">Marine Manager</a> | v1 API</h2>
<p>Global Fishing Watch and Dona Bertarelli have partnered to develop Global Fishing Watch Marine Manager. The portal empowers managers to rapidly collate and analyze scientific data integral to the governance of marine protected areas and other area-based conservation measures.</p>
<p><strong>Data in the Portal</strong> + V1 API | <a href="https://datasets.globalfishingwatch.org/">V1 API Queries</a> (Username: datasets | Password: gfw_doc). + Within the V1 API Queries are the BQ source datasets.</p>
<p><strong>Unique Features (compared to GFW Map):</strong> Environmental data layers</p>
<p><strong>Resources</strong> + <a href="https://globalfishingwatch.org/tutorials/">GFW Product Tutorials</a></p>
<p><strong>Upcoming/Future Plans</strong> + N/A</p>
<p><strong>Updates</strong> + Dec 9 2021: Marine Manager “v1.5” <a href="https://docs.google.com/document/d/1zndSgeY_kZN8yzRuLkquQ4b5CiJiohG8b6A1GpiFxVg/edit">release summary</a> <br></p>
</section>
<section id="vessel-viewer-v1-api" class="level2" data-number="6.10">
<h2 data-number="6.10" class="anchored" data-anchor-id="vessel-viewer-v1-api"><span class="header-section-number">6.10</span> <a href="https://globalfishingwatch.org/vessel-viewer">Vessel Viewer</a> | v1 API</h2>
<p>The Vessel Viewer, formally the Port Inspector App, is geared towards Port Inspectors and is currently being prototyped in the field. The App’s objective is to provide relevant information for port inspectors to assist them in identifying vessels which should be prioritized for inspection upon arrival in port.</p>
<p>At this time the Vessel Viewer is currently in development and available to GFW staff for internal use.</p>
<p>Vessel Viewer is part of GFWs broader effort to develop a suite of vessel intelligence tools to support (1) port inspection, (2) patrol planning, (3) insurance underwriting and (4) supply chain management to mitigate IUU risk.</p>
<p><strong>Data in the Portal</strong> + V1 API | <a href="https://datasets.globalfishingwatch.org/">V1 API Queries</a> (Username: datasets | Password: gfw_doc). + Within the V1 API Queries are the BQ source datasets.</p>
<p><strong>Resources</strong> + Vessel Viewer FAQ in <a href="https://drive.google.com/file/d/1N4YRJ_yxAObEIWbaYM8l-YDPHS0bKe2N/view">English</a> and <a href="https://drive.google.com/file/d/195mbtLoHaY7iltFUbogiEX1cZNBpFg4E/view">French</a> + Vessel Viewer How-To Guide in <a href="https://drive.google.com/file/d/1q2veC-EEUHWPg_eCplERJzlo8PL3OFZS/view">English</a> and <a href="https://drive.google.com/file/d/1QaO3XKaXSnerAtcgw_a9EJpUEtM3WHN2/view">French</a> + <a href="https://drive.google.com/file/d/18yenS9pva3kF2YGKZcSqdHy8avzRinBP/view">Vessel Viewer basic video overview</a> (audio in English with French subtitles)</p>
<p><strong>Upcoming/Future Plans</strong> + Add gaps to vessel viewer</p>
<p><strong>Updates</strong> + TBD <br></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Key-concepts.html" class="pagination-link" aria-label="Big Query Key concepts">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Big Query Key concepts</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Fishing-effort-and-vessel-presence.html" class="pagination-link" aria-label="(PART) Global Fishing Watch Datasets">
        <span class="nav-page-text">(PART) Global Fishing Watch Datasets</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/GlobalFishingWatch/GFW_technical_documentation/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>