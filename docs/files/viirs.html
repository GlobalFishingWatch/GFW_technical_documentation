<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>23&nbsp; VIIRS AIS matching – Global Fishing Watch documentation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../files/country-codes.html" rel="next">
<link href="../files/s2-vessel-detections.html" rel="prev">
<link href="../figures/GFW_logo.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../files/sar-object-detections.html">Object Detection</a></li><li class="breadcrumb-item"><a href="../files/viirs.html"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">VIIRS AIS matching</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Documentation Materials</a> 
        <div class="sidebar-tools-main">
    <a href="https://globalfishingwatch.org/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-house-door-fill"></i></a>
    <a href="https://github.com/GlobalFishingWatch/GFW_technical_documentation" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Data Overview</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/bigquery-datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">BigQuery Datasets</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/pipeline.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">GFW Pipelines</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/bigquery-pipe3-table-reference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">BigQuery Pipe 3 Table</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/bigquery-pipe2.5-table-reference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">BigQuery Pipe 2.5 Table</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/bigquery-key-concepts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">BigQuery Key Concepts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/bigquery-in-products.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">BigQuery to APIs to Products</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Vessel Identity</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/vessel-identity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Vessel Identity</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/identity-tables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Indentity Tables</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/vessel-database.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Vessel Database</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/vessel-info-tables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title"><code>vi_ssvid</code> tables</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/product-vessel-info-summary-pvis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Product Vessel Info Summary (PVIS)</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Vessel Tracking and Behavior</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/fishing-effort-and-vessel-presence.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Fishing Effort and Vessel Presence</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/coverage.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Coverage</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/vms-data-sources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">VMS Data Sources</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Events</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/encounters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Encounters</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/loitering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Loitering</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/gaps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Gaps</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/anchorages-voyages-port-visits.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Anchorages, Voyages and Port Visits</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/fishing-events.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Fishing Events</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Object Detection</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/sar-object-detections.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">SAR Object Detections</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/satellite-timing-offset-table.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Satellite Timing Offset</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/s2-vessel-detections.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Sentinel-2 Vessel Detections</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/viirs.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">VIIRS AIS matching</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Reference Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/country-codes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Country Codes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/areas-spatial-region-sources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Spatial Region Sources</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/areas-eez-boundaries.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">EEZ Boundaries</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/areas-12-nm-boundary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">12 NM Boundary</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/areas-rfmos.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">RFMOs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/areas-fao-areas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">FAO Areas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/areas-high-seas-pockets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">High Seas Pockets</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/areas-high-seas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">High Seas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/areas-protected-seas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Protected Seas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/areas-wdpa-marine-mpas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">WDPA Marine MPAs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/areas-point-in-polygon-test-using-regions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Point-in-polygon Test Using Regions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/areas-updating-layers-in-pipe_regions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Updating Layers in pipe_regions</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Resources</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/wiki-documentation-standards.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Wiki Documentation Standard</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/helpful-resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Helpful Resources</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../files/data-products-page-template.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">Data Products Page Template</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#repository" id="toc-repository" class="nav-link active" data-scroll-target="#repository"><span class="header-section-number">24</span> Repository</a></li>
  <li><a href="#key-tables" id="toc-key-tables" class="nav-link" data-scroll-target="#key-tables"><span class="header-section-number">25</span> Key tables</a></li>
  <li><a href="#data-descriptions" id="toc-data-descriptions" class="nav-link" data-scroll-target="#data-descriptions"><span class="header-section-number">26</span> Data descriptions</a></li>
  <li><a href="#caveats-known-issues" id="toc-caveats-known-issues" class="nav-link" data-scroll-target="#caveats-known-issues"><span class="header-section-number">27</span> Caveats &amp; Known Issues</a></li>
  <li><a href="#example-queries" id="toc-example-queries" class="nav-link" data-scroll-target="#example-queries"><span class="header-section-number">28</span> Example queries</a></li>
  <li><a href="#related-tables" id="toc-related-tables" class="nav-link" data-scroll-target="#related-tables"><span class="header-section-number">29</span> Related tables</a></li>
  <li><a href="#viirs-boat-detections" id="toc-viirs-boat-detections" class="nav-link" data-scroll-target="#viirs-boat-detections"><span class="header-section-number">30</span> VIIRS boat detections</a>
  <ul class="collapse">
  <li><a href="#key-tables-1" id="toc-key-tables-1" class="nav-link" data-scroll-target="#key-tables-1"><span class="header-section-number">30.1</span> Key Tables</a>
  <ul class="collapse">
  <li><a href="#current-version" id="toc-current-version" class="nav-link" data-scroll-target="#current-version"><span class="header-section-number">30.1.1</span> Current version</a></li>
  <li><a href="#older-version" id="toc-older-version" class="nav-link" data-scroll-target="#older-version"><span class="header-section-number">30.1.2</span> Older version</a></li>
  </ul></li>
  <li><a href="#data-description" id="toc-data-description" class="nav-link" data-scroll-target="#data-description"><span class="header-section-number">30.2</span> Data Description</a></li>
  <li><a href="#caveats-known-issues-1" id="toc-caveats-known-issues-1" class="nav-link" data-scroll-target="#caveats-known-issues-1"><span class="header-section-number">30.3</span> Caveats &amp; Known Issues</a>
  <ul class="collapse">
  <li><a href="#eezfmzmpa" id="toc-eezfmzmpa" class="nav-link" data-scroll-target="#eezfmzmpa"><span class="header-section-number">30.3.1</span> EEZ/FMZ/MPA</a></li>
  <li><a href="#the-south-atlantic-anomaly" id="toc-the-south-atlantic-anomaly" class="nav-link" data-scroll-target="#the-south-atlantic-anomaly"><span class="header-section-number">30.3.2</span> The South Atlantic Anomaly</a></li>
  <li><a href="#overlapping-detection" id="toc-overlapping-detection" class="nav-link" data-scroll-target="#overlapping-detection"><span class="header-section-number">30.3.3</span> Overlapping detection</a></li>
  <li><a href="#known-data-disruptions" id="toc-known-data-disruptions" class="nav-link" data-scroll-target="#known-data-disruptions"><span class="header-section-number">30.3.4</span> Known data disruptions</a></li>
  </ul></li>
  <li><a href="#example-queries-1" id="toc-example-queries-1" class="nav-link" data-scroll-target="#example-queries-1"><span class="header-section-number">30.4</span> Example queries</a></li>
  <li><a href="#related-tables-1" id="toc-related-tables-1" class="nav-link" data-scroll-target="#related-tables-1"><span class="header-section-number">30.5</span> Related tables</a></li>
  <li><a href="#updates" id="toc-updates" class="nav-link" data-scroll-target="#updates"><span class="header-section-number">30.6</span> Updates</a></li>
  </ul></li>
  <li><a href="#viirs-cloud-mask" id="toc-viirs-cloud-mask" class="nav-link" data-scroll-target="#viirs-cloud-mask"><span class="header-section-number">31</span> VIIRS cloud mask</a></li>
  <li><a href="#repository-1" id="toc-repository-1" class="nav-link" data-scroll-target="#repository-1"><span class="header-section-number">32</span> Repository</a></li>
  <li><a href="#key-tables-2" id="toc-key-tables-2" class="nav-link" data-scroll-target="#key-tables-2"><span class="header-section-number">33</span> Key tables</a></li>
  <li><a href="#data-descriptions-1" id="toc-data-descriptions-1" class="nav-link" data-scroll-target="#data-descriptions-1"><span class="header-section-number">34</span> Data descriptions</a></li>
  <li><a href="#caveats-known-issues-2" id="toc-caveats-known-issues-2" class="nav-link" data-scroll-target="#caveats-known-issues-2"><span class="header-section-number">35</span> Caveats &amp; Known Issues</a></li>
  <li><a href="#example-queries-2" id="toc-example-queries-2" class="nav-link" data-scroll-target="#example-queries-2"><span class="header-section-number">36</span> Example queries</a></li>
  <li><a href="#related-tables-2" id="toc-related-tables-2" class="nav-link" data-scroll-target="#related-tables-2"><span class="header-section-number">37</span> Related tables</a></li>
  <li><a href="#viirs---excluding-overlappint-detections-to-ais-matching-tables" id="toc-viirs---excluding-overlappint-detections-to-ais-matching-tables" class="nav-link" data-scroll-target="#viirs---excluding-overlappint-detections-to-ais-matching-tables"><span class="header-section-number">38</span> VIIRS - excluding overlappint detections to AIS Matching tables</a></li>
  <li><a href="#example-query" id="toc-example-query" class="nav-link" data-scroll-target="#example-query"><span class="header-section-number">39</span> Example query</a></li>
  <li><a href="#viirs-excluding-overlapping-detection" id="toc-viirs-excluding-overlapping-detection" class="nav-link" data-scroll-target="#viirs-excluding-overlapping-detection"><span class="header-section-number">40</span> VIIRS excluding overlapping detection</a></li>
  <li><a href="#example-query-1" id="toc-example-query-1" class="nav-link" data-scroll-target="#example-query-1"><span class="header-section-number">41</span> Example query</a></li>
  <li><a href="#viirs-footprint" id="toc-viirs-footprint" class="nav-link" data-scroll-target="#viirs-footprint"><span class="header-section-number">42</span> VIIRS footprint</a>
  <ul class="collapse">
  <li><a href="#repository-2" id="toc-repository-2" class="nav-link" data-scroll-target="#repository-2"><span class="header-section-number">42.1</span> Repository</a></li>
  <li><a href="#key-tables-3" id="toc-key-tables-3" class="nav-link" data-scroll-target="#key-tables-3"><span class="header-section-number">42.2</span> Key tables</a></li>
  </ul></li>
  <li><a href="#data-descriptions-2" id="toc-data-descriptions-2" class="nav-link" data-scroll-target="#data-descriptions-2"><span class="header-section-number">43</span> Data descriptions</a></li>
  <li><a href="#caveats-known-issues-3" id="toc-caveats-known-issues-3" class="nav-link" data-scroll-target="#caveats-known-issues-3"><span class="header-section-number">44</span> Caveats &amp; Known Issues</a></li>
  <li><a href="#example-queries-3" id="toc-example-queries-3" class="nav-link" data-scroll-target="#example-queries-3"><span class="header-section-number">45</span> Example queries</a></li>
  <li><a href="#related-tables-3" id="toc-related-tables-3" class="nav-link" data-scroll-target="#related-tables-3"><span class="header-section-number">46</span> Related tables</a></li>
  <li><a href="#join-with-viirs-table" id="toc-join-with-viirs-table" class="nav-link" data-scroll-target="#join-with-viirs-table"><span class="header-section-number">47</span> Join with VIIRS table</a></li>
  <li><a href="#viirs-noise-filter" id="toc-viirs-noise-filter" class="nav-link" data-scroll-target="#viirs-noise-filter"><span class="header-section-number">48</span> VIIRS noise filter</a>
  <ul class="collapse">
  <li><a href="#example-query-2" id="toc-example-query-2" class="nav-link" data-scroll-target="#example-query-2"><span class="header-section-number">48.1</span> Example query</a></li>
  <li><a href="#repository-3" id="toc-repository-3" class="nav-link" data-scroll-target="#repository-3"><span class="header-section-number">48.2</span> Repository</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/GlobalFishingWatch/GFW_technical_documentation/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../files/sar-object-detections.html">Object Detection</a></li><li class="breadcrumb-item"><a href="../files/viirs.html"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">VIIRS AIS matching</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">VIIRS AIS matching</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Each row of this table is corresponding to VIIRS detection and this table also contains the AIS/VMS vessel’s IDs (<code>ssvid</code>) corresponding to each VIIRS detection.</p>
<p>This table was created from the VIIRS table after excluding <a href="VIIRS-noise-filter">the South American noise</a>. Thus, <strong>this table can also be used as noise-free VIIRS table</strong>.</p>
<section id="repository" class="level1" data-number="24">
<h1 data-number="24"><span class="header-section-number">24</span> Repository</h1>
<p>Please look at README in the repository for how to update this table.</p>
<ul>
<li>https://github.com/GlobalFishingWatch/prj-viirs-matching</li>
</ul>
</section>
<section id="key-tables" class="level1" data-number="25">
<h1 data-number="25"><span class="header-section-number">25</span> Key tables</h1>
<p>Current version</p>
<ul>
<li><code>pipe_production_v20201001.proto_matches_raw_vbd_global_3top_v20210514</code>
<ul>
<li>VIIRS matches to AIS and VMS</li>
</ul></li>
<li><code>pipe_production_v20201001.proto_viirs_match_ais_matches</code>
<ul>
<li>VIIRS matches to only AIS</li>
</ul></li>
</ul>
</section>
<section id="data-descriptions" class="level1" data-number="26">
<h1 data-number="26"><span class="header-section-number">26</span> Data descriptions</h1>
<ul>
<li><code>detect_id</code>
<ul>
<li>unique id for each records (i.e.&nbsp;VIIRS detection).</li>
<li>Using this key, you can join with VIIRS table (<code>pipe_viirs_production_v20180723.raw_vbd_global</code>).</li>
<li><code>concat(cast(Date_Mscan as string),concat(cast(Lat_DNB as string),cast(Lon_DNB as string))) as detect_id,</code></li>
</ul></li>
<li><code>detect_timestamp</code>
<ul>
<li>timespamp of VIIRS detection in UTC.</li>
<li>Same as <code>Date_Mscan</code></li>
</ul></li>
<li><code>detect_lat</code>
<ul>
<li>latitude of VIIRS detection.</li>
<li>Same as <code>Lat_DNB</code></li>
</ul></li>
<li><code>detect_lon</code>
<ul>
<li>longitude of VIIRS detection.</li>
<li>Same as <code>Lon_DNB</code></li>
</ul></li>
<li><code>QF_Detect</code>
<ul>
<li>Integer quality flag for VIIRS detection, yielding information about quality and type of detection</li>
<li>See <a href="https://github.com/GlobalFishingWatch/bigquery-documentation-wf827/wiki/VIIRS-boat-detections#data-description">Data description of VIIRS table</a></li>
</ul></li>
<li><code>OrbitNumber</code>
<ul>
<li>Single overpass of VIIRS satelite (from North to South at night) can be distinguishable by <code>OrbitNumber</code>.</li>
<li><code>CAST(SUBSTR(File_DNB, 40,5) AS INT64) AS OrbitNumber,</code></li>
</ul></li>
<li><code>GranuleID</code>
<ul>
<li>This field can be used to join with <a href="VIIRS-footprint">VIIRS footprint table</a> and <a href="VIIRS-cloud-mask">VIIRS-cloud-mask</a>.</li>
<li>Format: <code>A</code> + Year (2017 ~ ) + Day_of_the_year(001 ~ 366) + hour (00~24) + minutes (00 ~ 60)</li>
<li>Each <code>GranuleID</code> is corresponding to 6 minutes time window. for example <code>GranuleID = 'A2017001.0024'</code> contains VIIRS detection from <code>2017-01-01 00:24</code> to <code>2017-01-01 00:30</code>.</li>
<li><code>CONCAT("A", CAST(extract(YEAR from Date_Mscan) as STRING), LPAD(CAST(extract(DAYOFYEAR from Date_Mscan) as STRING), 3, "0"), ".", LPAD(CAST(extract(HOUR from Date_Mscan) as STRING), 2, "0"), LPAD(CAST(DIV(extract(MINUTE from Date_Mscan), 6)*6 as STRING), 2, "0") ) as GranuleID</code></li>
</ul></li>
<li><code>RAD_DNB</code>
<ul>
<li>The brightness (radiance) of the VBD pixel (Unit: nW/cm2/sr)</li>
</ul></li>
<li><code>source</code>
<ul>
<li>source of vessel track data (i.e.&nbsp;<code>AIS</code>or VMS like <code>indovms</code>, <code>panama_vms</code>) that matched with the VIIRS</li>
</ul></li>
<li><code>ssvid</code>
<ul>
<li><code>ssvid</code> of the vessel that matched with the VIIRS</li>
</ul></li>
<li><code>seg_id</code>
<ul>
<li><code>seg_id</code> of the vessel that matched with the VIIRS</li>
</ul></li>
<li><code>score</code>
<ul>
<li>Matching score between VIIRS and AIS/VMS. Higher value indicates good matching (<code>score &gt; 0.01</code> is a tentative threshold for good matching.)</li>
</ul></li>
</ul>
</section>
<section id="caveats-known-issues" class="level1" data-number="27">
<h1 data-number="27"><span class="header-section-number">27</span> Caveats &amp; Known Issues</h1>
<ul>
<li>Overlapping detection VIIRS satelite may scan the same area twice a night, thus VIIRS may double count the same vessel. To avoid double counting, you can select single scan for each 1 degree grid for a night. See example query.</li>
</ul>
</section>
<section id="example-queries" class="level1" data-number="28">
<h1 data-number="28"><span class="header-section-number">28</span> Example queries</h1>
<ul>
<li><a href="Join-with-VIIRS-table">Join with VIIRS table</a></li>
<li><a href="Excluding-overlapping-detection-from-VIIRS-AIS-matching-table">Excluding overlapping detection from VIIRS-AIS matching table</a>: eliminate possible double-counting of VIIRS detection.</li>
<li>Get VIIRS detection in the squid fishing area</li>
<li>Join with VIIRS footprint</li>
<li>Join with VIIRS-AIS matching</li>
</ul>
</section>
<section id="related-tables" class="level1" data-number="29">
<h1 data-number="29"><span class="header-section-number">29</span> Related tables</h1>
<ul>
<li><a href="VIIRS-boat-detections">VIIRS boat detections</a></li>
<li><a href="VIIRS-footprint">VIIRS footprint</a></li>
<li><a href="VIIRS-cloud-mask">VIIRS cloud mask</a></li>
</ul>
</section>
<section id="viirs-boat-detections" class="level1" data-number="30">
<h1 data-number="30"><span class="header-section-number">30</span> VIIRS boat detections</h1>
<p>VIIRS, or Visible Infrared Imaging Radiometer Suite, is a sensor onboard the Suomi National Polar-orbiting Partnership and NOAA-20 weather satellites. VIIRS collects imagery and radiometric measurements that, among other applications, are used to detect bright lights at night. VIIRS can be used to detect vessels at night and <a href="https://www.ngdc.noaa.gov/eog/index.html">NOAA’s Earth Observation Group</a> produces a nightly VIIRS Boat Detection (VBD) dataset. The VBD reports the locations of boats detected based on lights and is directly used by GFW.</p>
<section id="key-tables-1" class="level2" data-number="30.1">
<h2 data-number="30.1" class="anchored" data-anchor-id="key-tables-1"><span class="header-section-number">30.1</span> Key Tables</h2>
<section id="current-version" class="level3" data-number="30.1.1">
<h3 data-number="30.1.1" class="anchored" data-anchor-id="current-version"><span class="header-section-number">30.1.1</span> Current version</h3>
<ul>
<li><code>pipe_viirs_production_v20220112.raw_vbd_global</code>
<ul>
<li>This table contains all the VBDs including non-vessel detections.</li>
<li>partitioned by <code>Date_Mscan</code></li>
</ul></li>
<li><code>pipe_viirs_production_v20220112.raw_vbd_global_without_noise</code>
<ul>
<li>This table contains <strong>only true vessel detections</strong>. The noise removal query <a href="https://github.com/GlobalFishingWatch/pipe-viirs/blob/main/assets/load-vbd-without-noise.sql.j2#L51">can be found here</a>.</li>
<li>partitioned by <code>Date_Mscan</code></li>
<li>This table has a subset of columns from the <code>raw_vbd_global</code> table and some additional columns for the convenience of analysts. If you want columns not included in this table, you need to get it from <code>raw_vbd_global</code> table by joining with <code>id_Key</code> field.</li>
</ul></li>
</ul>
</section>
<section id="older-version" class="level3" data-number="30.1.2">
<h3 data-number="30.1.2" class="anchored" data-anchor-id="older-version"><span class="header-section-number">30.1.2</span> Older version</h3>
<ul>
<li><code>pipe_viirs_production_v20180723.raw_vbd_global</code>
<ul>
<li>Global VBD dataset.</li>
</ul></li>
<li><code>pipe_viirs_production_v20180723.raw_vbd_redacted</code>
<ul>
<li>VBD dataset without detections around South America (see Caveats).</li>
<li><strong>No need to use this table</strong>. Use <a href="VIIRS-noise-filter">VIIRS noise filter</a> to avoid false detection around South America.</li>
<li><strong>Not updated since <code>2019-11-30</code></strong></li>
</ul></li>
</ul>
</section>
</section>
<section id="data-description" class="level2" data-number="30.2">
<h2 data-number="30.2" class="anchored" data-anchor-id="data-description"><span class="header-section-number">30.2</span> Data Description</h2>
<p>The VBD dataset and underlying methods are outlined in the following publication:</p>
<p><a href="https://www.mdpi.com/2072-4292/7/3/3020">Elvidge, C., Zhizhin, M., Baugh, K., &amp; Hsu, F. C. (2015). An automatic boat identification system for VIIRS low light imaging data. Remote Sensing, 7(3), 3020-3036.</a>.</p>
<p>GFW retains all VBD, including the following key fields:</p>
<ul>
<li><p><code>Date_Mscan</code>: VBD pixel date-time at mid-point of DNB scan reported in Universal Time.</p></li>
<li><p><code>id_Key</code>: Unique VBD ID.</p></li>
<li><p><code>Lat_DNB</code>: VBD pixel latitude from VIIRS DNB geolocation file.</p></li>
<li><p><code>Lon_DNB</code>: VBD pixel longitude from VIIRS DNB geolocation file.</p></li>
<li><p><code>Date_LTZ</code>: VBD pixel date-time at mid-point of DNB scan adjusted to standard time in the local time zone (LTZ). No adjustments for Daylight Savings Time (DST) are made.</p></li>
<li><p><code>EEZ</code>: Exclusive Economic Zone for VBD pixel.</p></li>
<li><p><code>FMZ</code>: Fishery Management Zone for VBD pixel</p></li>
<li><p><code>MPA</code>: Marine Protected Area for VBD pixel</p></li>
<li><p><code>RAD_DNB</code> : The brightness (radiance) of the VBD pixel (Unit: nW/cm2/sr)</p></li>
<li><p><code>QF_Detect</code>: Integer quality flag for VBD pixel, yielding information about quality and type of detection.</p>
<ul>
<li><code>1</code>: Strong detection. Detection surpassed all VBD threshold tests</li>
<li><code>2</code>: Weak detection. Detection did not pass SHI threshold test.</li>
<li><code>3</code>: Blurry detection. Detection did not pass SI threshold test.</li>
<li><code>4</code>: Gas flare. Detection has a concurrent Nightfire detection or is in the location of a known gas flare.</li>
<li><code>5</code>: False detection: Detection is from high-energy particles impacting the DNB sensor, usually due to the South Atlantic anomaly.</li>
<li><code>6</code>: False detection: Detection is from lunar glint.</li>
<li><code>7</code>: False detection: Detection is from atmospheric glow around bright sources.</li>
<li><code>8</code>: Recurring detection. Detection is in locations where boats are known to recur.</li>
<li><code>9</code>: False detection: Detection is from sensor crosstalk around extremely bright sources, usually flares.</li>
<li><code>10</code>: Weak and blurry detection. Detection did not pass either the SHI or SI threshold tests.</li>
<li><code>11</code>: Offshore platform. Detection is in the location of a known stable light.</li>
</ul></li>
<li><p><code>SATZ_GDNBO</code> : Satelite Zenith Angle</p></li>
<li><p><code>SOLZ_GDNBO</code>: Sun Zenith Angle</p></li>
<li><p><code>LUNZ_GDNBO</code>: Moon Zenith Angle</p>
<p>(See <a href="https://eogdata.mines.edu/vbd/vbd_readme_v23_r20180824.xlsx">document on Colorado School of Mines: Earth Observation Group</a> for a description of all the columns.)</p></li>
</ul>
<p>Other useful fields you can create from this table:</p>
<ul>
<li><code>detect_id</code>
<ul>
<li>unique id for each record (VIIRS detection).</li>
<li>Using this key, you can join with <a href="VIIRS-AIS-matching">VIIRS-AIS matching table</a>.</li>
<li><code>concat(cast(Date_Mscan as string),concat(cast(Lat_DNB as string),cast(Lon_DNB as string))) as detect_id,</code></li>
</ul></li>
<li><code>OrbitNumber</code>
<ul>
<li>Single overpass of VIIRS satellite (from North to South at night) can be distinguishable by <code>OrbitNumber</code>.</li>
<li>This field can be used to eliminate overlap between successive orbits.</li>
<li><code>CAST(SUBSTR(File_DNB, 40,5) AS INT64) AS OrbitNumber,</code></li>
</ul></li>
<li><code>GranuleID</code>
<ul>
<li>This field can be used to join with <a href="VIIRS-footprint">VIIRS footprint table</a> and <a href="VIIRS-cloud-mask">VIIRS cloud mask</a>.</li>
<li>A + Year (2017) + Day_of_the_year(001 ~ 365) + hour (00~24) + minutes (00 ~ 60)</li>
<li>Each <code>GranuleID</code> is corresponding to 6 minutes time window. for example <code>GranuleID = 'A2017001.0024'</code> contains VIIRS detection from <code>2017-01-01 00:24</code> to <code>2017-01-01 00:30</code>.</li>
<li><code>CONCAT("A", CAST(extract(YEAR from Date_Mscan) as STRING), LPAD(CAST(extract(DAYOFYEAR from Date_Mscan) as STRING), 3, "0"), ".", LPAD(CAST(extract(HOUR from Date_Mscan) as STRING), 2, "0"), LPAD(CAST(DIV(extract(MINUTE from Date_Mscan), 6)*6 as STRING), 2, "0") ) as GranuleID</code></li>
</ul></li>
</ul>
</section>
<section id="caveats-known-issues-1" class="level2" data-number="30.3">
<h2 data-number="30.3" class="anchored" data-anchor-id="caveats-known-issues-1"><span class="header-section-number">30.3</span> Caveats &amp; Known Issues</h2>
<section id="eezfmzmpa" class="level3" data-number="30.3.1">
<h3 data-number="30.3.1" class="anchored" data-anchor-id="eezfmzmpa"><span class="header-section-number">30.3.1</span> EEZ/FMZ/MPA</h3>
<p>The EEZ/FMZ/MPA values in the VBD data are not modified by GFW and may differ from the AIS/VMS data (<strong>Verify this is the case</strong>).</p>
</section>
<section id="the-south-atlantic-anomaly" class="level3" data-number="30.3.2">
<h3 data-number="30.3.2" class="anchored" data-anchor-id="the-south-atlantic-anomaly"><span class="header-section-number">30.3.2</span> The South Atlantic Anomaly</h3>
<p>The VIIRS contains a lot of false detection around South America, which is caused by the South Atlantic Anomaly (SAA). The SAA is an area where the Earth’s inner Van Allen radiation belt is at its lowest altitude, allowing more energetic particles from space to penetrate. When such a particle hits the sensors on board the satellite, it creates a false signal which might cause the VBD algorithm to recognize it as a boat detection.</p>
<p>To avoid false positives due to the South Atlantic Anomaly, we’ve developed a <a href="VIIRS-noise-filter">VIIRS noise filter</a>.</p>
</section>
<section id="overlapping-detection" class="level3" data-number="30.3.3">
<h3 data-number="30.3.3" class="anchored" data-anchor-id="overlapping-detection"><span class="header-section-number">30.3.3</span> Overlapping detection</h3>
<p>VIIRS satellite may scan the same area twice a night, thus VIIRS may double count the same vessel. To avoid double-counting, you can select a single scan for each 1-degree grid for a night. <a href="Excluding-overlapping-detection-of-VIIRS">See example query</a>.</p>
</section>
<section id="known-data-disruptions" class="level3" data-number="30.3.4">
<h3 data-number="30.3.4" class="anchored" data-anchor-id="known-data-disruptions"><span class="header-section-number">30.3.4</span> Known data disruptions</h3>
<ul>
<li><strong>June 28 to July 7, 2022</strong>: The Suomi NPP satellite experienced <a href="https://www.ospo.noaa.gov/data/messages/2022/07/MSG_20220707_2318.html">issues</a> on June 28, 2022 that resulted in excessive edge noise in the day / night band. There’s an unusually high number of VBD in some regions (e.g., within Gabon, Pakistan, India, Myanmar, Taiwan, China, and a few other places in Africa, Mediterranean Sea, and Asia), on June 28 and 29 and significantly fewer detections (globally) after, until July 7th.</li>
<li><strong>July 26 to August 20, 2022</strong>: VIIRS Boat Detection data are not available from July 26 to August 20, 2022. The Suomi NPP satellite entered a non-nominal state during this period (<a href="https://lpdaac.usgs.gov/news/suomi-npp-recovers-from-safe-mode2/">announcement</a>).</li>
</ul>
</section>
</section>
<section id="example-queries-1" class="level2" data-number="30.4">
<h2 data-number="30.4" class="anchored" data-anchor-id="example-queries-1"><span class="header-section-number">30.4</span> Example queries</h2>
<ul>
<li><p><a href="https://github.com/GlobalFishingWatch/bigquery-documentation-wf827/blob/master/queries/viirs_get_points_date_area.sql">How to extract VBDs from specific dates and areas?</a></p></li>
<li><p><a href="https://github.com/GlobalFishingWatch/bigquery-documentation-wf827/blob/master/queries/viirs_get_daily_count_without_double_counting.sql">How to eliminate double-counting from VIIRS?</a></p></li>
<li><p>Get VIIRS detection in the squid fishing area</p></li>
<li><p>Join with VIIRS footprint</p></li>
<li><p>Join with VIIRS-AIS matching</p></li>
</ul>
</section>
<section id="related-tables-1" class="level2" data-number="30.5">
<h2 data-number="30.5" class="anchored" data-anchor-id="related-tables-1"><span class="header-section-number">30.5</span> Related tables</h2>
<ul>
<li><a href="VIIRS-AIS-matching">VIIRS AIS matching</a></li>
<li><a href="VIIRS-cloud-mask">VIIRS cloud mask</a></li>
<li><a href="VIIRS-footprint">VIIRS footprint</a></li>
<li><a href="VIIRS-noise-filter">Logic of VIIRS noise filter</a>: eliminate VIIRS noise especially the South Atlantic Anomaly.</li>
</ul>
</section>
<section id="updates" class="level2" data-number="30.6">
<h2 data-number="30.6" class="anchored" data-anchor-id="updates"><span class="header-section-number">30.6</span> Updates</h2>
<ul>
<li><code>pipe_viirs_production_v20220112.raw_vbd_global</code>
<ul>
<li>Missing VBD issue in the previous version is solved for the dates after <code>2020-01-07</code>. There may be still issues before the date.</li>
</ul></li>
<li><code>pipe_viirs_production_v20180723.raw_vbd_global</code>
<ul>
<li>It turns out that this table is missing some detections in the Asian region for some period.</li>
</ul></li>
</ul>
</section>
</section>
<section id="viirs-cloud-mask" class="level1" data-number="31">
<h1 data-number="31"><span class="header-section-number">31</span> VIIRS cloud mask</h1>
<p>This table contains information on the Cloud presence/absence data derived from VIIRS satellite (Suomi-NPP). The data was obtained from <a href="https://ladsweb.modaps.eosdis.nasa.gov/missions-and-measurements/products/CLDMSK_L2_VIIRS_SNPP/">CLDMSK_L2_VIIRS_SNPP</a>. The table is aggregated into a 0.1-degree grid (represented by <code>lat_bin</code>, <code>lon_bin</code>).</p>
<p>Each record of this table represents a grid cell of a granule (i.e.&nbsp;this table will be unique using fields <code>GranuleId</code>, <code>lat_bin</code>and <code>lon_bin</code>).</p>
</section>
<section id="repository-1" class="level1" data-number="32">
<h1 data-number="32"><span class="header-section-number">32</span> Repository</h1>
<p>Non but the codes exist in the VM instance <code>viirs-cloud-mask</code>.</p>
</section>
<section id="key-tables-2" class="level1" data-number="33">
<h1 data-number="33"><span class="header-section-number">33</span> Key tables</h1>
<p>Current version</p>
<ul>
<li><code>scratch_masaki.cloud_mask_10th_degree_grid</code></li>
</ul>
<p>Older version</p>
<p>non</p>
</section>
<section id="data-descriptions-1" class="level1" data-number="34">
<h1 data-number="34"><span class="header-section-number">34</span> Data descriptions</h1>
<ul>
<li><code>GranuleID</code> : ID of this granule. See <a href="VIIRS-footprint">VIIRS footprint</a> for the explanation of granule.</li>
<li><code>lat_bin</code> : 0.1-degree grid latitude. <code>round(lat*10)</code></li>
<li><code>lon_bin</code> : 0.1-degree grid longitude. <code>round(lon*10)</code></li>
<li><code>OrbitNumber</code> : ID of this orbit.</li>
<li><code>StartDateTime</code> : Start datetime of this granule.</li>
<li><code>mean_integer_cloud_mask</code> : Cloud condition of this pixel (0 = cloudy, 1= probably cloudy, 2 = probably clear, 3 = confident clear). The original VIIRS CLOUD MASK have integer value, but the value is averaged for each 0.1-degree grid in this table. Thus, this field contains real number from 0 to 3.</li>
<li><code>mean_sensor_zenith</code> : Mean zenith angle of VIIRS satelite in this pixel.</li>
<li><code>lat</code> : 0.1-degree grid latitude. <code>0.1*round(lat*10)</code></li>
<li><code>lon</code> : 0.1-degree grid longitude. <code>0.1*round(lat*10)</code></li>
</ul>
</section>
<section id="caveats-known-issues-2" class="level1" data-number="35">
<h1 data-number="35"><span class="header-section-number">35</span> Caveats &amp; Known Issues</h1>
<ul>
<li>This table does not include cloud information over land.</li>
<li><code>mean_integer_cloud_mask</code> represents only presense/absence of the cloud, thus the cloud thickness is not taken into account.</li>
</ul>
</section>
<section id="example-queries-2" class="level1" data-number="36">
<h1 data-number="36"><span class="header-section-number">36</span> Example queries</h1>
</section>
<section id="related-tables-2" class="level1" data-number="37">
<h1 data-number="37"><span class="header-section-number">37</span> Related tables</h1>
<p><br></p>
</section>
<section id="viirs---excluding-overlappint-detections-to-ais-matching-tables" class="level1" data-number="38">
<h1 data-number="38"><span class="header-section-number">38</span> VIIRS - excluding overlappint detections to AIS Matching tables</h1>
<p>Single VIIRS overpass from North to South at night can be distinguishable using OrbitNumber. And Successive VIIRS overpasses have overlapping regions. To eliminate the overlapping, We will choose an overpass (i.e OrbitNumber) with a smaller satellite zenith angle for each 1-degree grid area for each day.</p>
</section>
<section id="example-query" class="level1" data-number="39">
<h1 data-number="39"><span class="header-section-number">39</span> Example query</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> TEMP <span class="kw">FUNCTION</span> start_date() <span class="kw">AS</span> (<span class="dt">DATE</span>(<span class="st">'2020-01-01'</span>));</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> TEMP <span class="kw">FUNCTION</span> end_date() <span class="kw">AS</span> (<span class="dt">DATE</span>(<span class="st">'2020-01-02'</span>));</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a># Eliminate overlapping detection <span class="kw">from</span> VIIRS<span class="op">-</span>AIS matching <span class="kw">table</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a># <span class="dt">Single</span> VIIRS overpass <span class="kw">from</span> North <span class="kw">to</span> South <span class="kw">at</span> night can be distinguishable <span class="kw">using</span> OrbitNumber.</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a># <span class="kw">And</span> Successive VIIRS overpasses have overlapping regions. </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a># <span class="kw">To</span> eliminate <span class="kw">the</span> overlapping, we will <span class="kw">choose</span> an overpass (i.e OrbitNumber) <span class="kw">with</span> a smaller satellite zenith angle <span class="cf">for</span> <span class="kw">each</span> <span class="fl">0.1</span> <span class="kw">degree</span> grid area <span class="cf">for</span> <span class="kw">each</span> <span class="dt">day</span>.</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span> </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a># VIIRS<span class="op">-</span>AIS matching <span class="kw">table</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>viirs_matching <span class="kw">AS</span> (</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span>  </span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">DATE</span>(detect_timestamp) <span class="kw">as</span> <span class="dt">date</span>,</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    # <span class="dv">1</span> <span class="kw">degree</span> grid bin</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">CAST</span>(<span class="fu">round</span>(detect_lat) <span class="kw">as</span> INT64) <span class="kw">as</span> lat_bin,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">CAST</span>(<span class="fu">round</span>(detect_lon) <span class="kw">as</span> INT64) <span class="kw">as</span> lon_bin,</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>,</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    `world<span class="op">-</span>fishing<span class="op">-</span><span class="fl">827.</span>gfw_research.matches_raw_vbd_global_3top_v20210514`</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>      <span class="dt">DATE</span>(_PARTITIONTIME) <span class="kw">BETWEEN</span> start_date() <span class="kw">AND</span> end_date()</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a># VIIRS <span class="kw">table</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>viirs <span class="kw">AS</span> (</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    # <span class="dt">date</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Date</span>(Date_Mscan) <span class="kw">as</span> <span class="dt">date</span>,    </span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    # <span class="dv">1</span> <span class="kw">degree</span> grid bin</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">CAST</span>(<span class="fu">round</span>(Lat_DNB) <span class="kw">as</span> INT64) <span class="kw">as</span> lat_bin,</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">CAST</span>(<span class="fu">round</span>(Lon_DNB) <span class="kw">as</span> INT64) <span class="kw">as</span> lon_bin,</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    # OrbitNumber</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">CAST</span>(<span class="fu">SUBSTR</span>(File_DNB, <span class="dv">40</span>,<span class="dv">5</span>) <span class="kw">AS</span> INT64) <span class="kw">AS</span> OrbitNumber,</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    # Satelite Zenith Angle</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    SATZ_GDNBO,</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    `world<span class="op">-</span>fishing<span class="op">-</span><span class="fl">827.</span>pipe_viirs_production_v20180723.raw_vbd_global`</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    <span class="dt">DATE</span>(_PARTITIONTIME) <span class="kw">BETWEEN</span> start_date() <span class="kw">AND</span> end_date()</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a># Aggregate Satelite Zenith Angle <span class="cf">for</span> <span class="kw">each</span> grid<span class="op">-</span>Orbit<span class="op">-</span><span class="dt">date</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>date_orbit_grid_zenith <span class="kw">as</span> (</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>    <span class="dt">date</span>,</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>    OrbitNumber,</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>    lat_bin,</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>    lon_bin,</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.5</span><span class="op">*</span>(<span class="fu">max</span>(SATZ_GDNBO) <span class="op">+</span> <span class="fu">min</span>(SATZ_GDNBO)) <span class="kw">as</span> SATZ_GDNBO,</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>  <span class="kw">from</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>    viirs</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>  <span class="kw">GROUP</span> <span class="kw">BY</span> </span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>    <span class="dt">date</span>, OrbitNumber, lat_bin, lon_bin</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a># <span class="kw">Select</span> smallest zenith orbit <span class="cf">for</span> <span class="kw">each</span> grid <span class="kw">and</span> <span class="dt">day</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a># This <span class="kw">is</span> used <span class="cf">for</span> eliminate overlapping area <span class="kw">from</span> successive orbits</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>smallest_zenith_orbit <span class="kw">as</span> (</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>  <span class="kw">SELECT</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>    <span class="dt">date</span>,</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>    lat_bin,</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>    lon_bin,</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>    OrbitNumber,</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    SATZ_GDNBO,</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>    row_num</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>  <span class="kw">FROM</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>    (</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>      <span class="kw">select</span> </span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>        <span class="op">*</span>,</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ROW_NUMBER</span>() <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> <span class="dt">date</span>, lat_bin, lon_bin <span class="kw">ORDER</span> <span class="kw">BY</span> SATZ_GDNBO ) <span class="kw">AS</span> row_num</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>      <span class="kw">FROM</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>        date_orbit_grid_zenith</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>  <span class="kw">WHERE</span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>    row_num  <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a># <span class="fu">Extract</span> detection <span class="kw">only</span> <span class="kw">from</span> smallest zenith orbits <span class="cf">for</span> <span class="kw">each</span> grid <span class="kw">and</span> <span class="dt">day</span></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>  a.<span class="op">*</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>  viirs_matching a</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>  <span class="kw">inner</span> <span class="kw">join</span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>  smallest_zenith_orbit b</span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>  <span class="kw">using</span>(<span class="dt">date</span>, OrbitNumber, lat_bin, lon_bin)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="viirs-excluding-overlapping-detection" class="level1" data-number="40">
<h1 data-number="40"><span class="header-section-number">40</span> VIIRS excluding overlapping detection</h1>
<p>Single VIIRS overpass from North to South at night can be distinguishable using OrbitNumber. And Successive VIIRS overpasses have overlapping regions. To eliminate the overlapping, We will choose an overpass (i.e OrbitNumber) with a smaller satellite zenith angle for each 1-degree grid area for each day.</p>
</section>
<section id="example-query-1" class="level1" data-number="41">
<h1 data-number="41"><span class="header-section-number">41</span> Example query</h1>
<div class="sourceCode" id="cb2"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a># Eliminate overlapping detection <span class="kw">from</span> VIIRS</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a># <span class="dt">Single</span> VIIRS overpass <span class="kw">from</span> North <span class="kw">to</span> South <span class="kw">at</span> night can be distinguishable <span class="kw">using</span> OrbitNumber.</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a># <span class="kw">And</span> Successive VIIRS overpasses have overlapping region. </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a># <span class="kw">To</span> eliminate <span class="kw">the</span> overlapping, We will <span class="kw">choose</span> an overpass (i.e OrbitNumber) <span class="kw">with</span> a smaller satellite zenith angle <span class="cf">for</span> <span class="kw">each</span> <span class="dv">1</span><span class="op">-</span><span class="kw">degree</span> grid area <span class="cf">for</span> <span class="kw">each</span> <span class="dt">day</span>.</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span> </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a># VIIRS detection</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>viirs <span class="kw">AS</span> (</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span>  </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Date</span>(Date_Mscan) <span class="kw">as</span> <span class="dt">date</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    Date_Mscan,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    Lat_DNB,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    Lon_DNB,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    Rad_DNB,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    QF_Detect,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    # <span class="dv">1</span> <span class="kw">degree</span> grid bin</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">CAST</span>(<span class="fu">round</span>(Lat_DNB) <span class="kw">as</span> INT64) <span class="kw">as</span> lat_bin,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">CAST</span>(<span class="fu">round</span>(Lon_DNB) <span class="kw">as</span> INT64) <span class="kw">as</span> lon_bin,</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    # OrbitNumber</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">CAST</span>(<span class="fu">SUBSTR</span>(File_DNB, <span class="dv">40</span>,<span class="dv">5</span>) <span class="kw">AS</span> INT64) <span class="kw">AS</span> OrbitNumber,</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    # Satelite Zenith Angle</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    SATZ_GDNBO,</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    `world<span class="op">-</span>fishing<span class="op">-</span><span class="fl">827.</span>pipe_viirs_production_v20180723.raw_vbd_global`</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>      <span class="dt">DATE</span>(_PARTITIONTIME) <span class="kw">BETWEEN</span> <span class="ot">"2020-01-01"</span> <span class="kw">AND</span> <span class="ot">"2020-01-01"</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a># Calculate Satelite Zenith Angle <span class="cf">for</span> <span class="kw">each</span> grid<span class="op">-</span>Orbit<span class="op">-</span><span class="dt">date</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>date_orbit_grid_zenith <span class="kw">as</span> (</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    <span class="dt">date</span>,</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    OrbitNumber,</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    lat_bin,</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    lon_bin,</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.5</span><span class="op">*</span>(<span class="fu">max</span>(SATZ_GDNBO) <span class="op">+</span> <span class="fu">min</span>(SATZ_GDNBO)) <span class="kw">as</span> SATZ_GDNBO,</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>  <span class="kw">from</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    viirs</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>  <span class="kw">GROUP</span> <span class="kw">BY</span> </span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>    <span class="dt">date</span>, OrbitNumber, lat_bin, lon_bin</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a># <span class="kw">Select</span> smallest zenith orbit <span class="cf">for</span> <span class="kw">each</span> grid <span class="kw">and</span> <span class="dt">day</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a># This <span class="kw">is</span> used <span class="cf">for</span> eliminate overlapping area <span class="kw">from</span> successive orbits</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>smallest_zenith_orbit <span class="kw">as</span> (</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>  <span class="kw">SELECT</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>    <span class="dt">date</span>,</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>    lat_bin,</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>    lon_bin,</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>    OrbitNumber,</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>    SATZ_GDNBO,</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>    row_num</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>  <span class="kw">FROM</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>    (</span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>      <span class="kw">select</span> </span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>        <span class="op">*</span>,</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ROW_NUMBER</span>() <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> <span class="dt">date</span>, lat_bin, lon_bin <span class="kw">ORDER</span> <span class="kw">BY</span> SATZ_GDNBO ) <span class="kw">AS</span> row_num</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>      <span class="kw">FROM</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>        date_orbit_grid_zenith</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>  <span class="kw">WHERE</span></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>    row_num  <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a># <span class="fu">Extract</span> detection <span class="kw">only</span> <span class="kw">from</span> smallest zenith orbit <span class="cf">for</span> <span class="kw">each</span> grid <span class="kw">and</span> <span class="dt">day</span></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>  a.<span class="op">*</span></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>  viirs a</span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>  <span class="kw">inner</span> <span class="kw">join</span></span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>  smallest_zenith_orbit b</span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>  <span class="kw">using</span>(<span class="dt">date</span>, OrbitNumber, lat_bin, lon_bin)</span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a><span class="kw">where</span></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>  QF_Detect <span class="kw">IN</span> (<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="viirs-footprint" class="level1" data-number="42">
<h1 data-number="42"><span class="header-section-number">42</span> VIIRS footprint</h1>
<p>VIIRS footprint table contains information on the area observed by the VIIRS satellite (Suomi-NPP). The data is obtained from <a href="https://ladsweb.modaps.eosdis.nasa.gov/archive/geoMetaJPSS/5110/NPP/">NASA LAADS</a>.</p>
<section id="repository-2" class="level2" data-number="42.1">
<h2 data-number="42.1" class="anchored" data-anchor-id="repository-2"><span class="header-section-number">42.1</span> Repository</h2>
<p>https://github.com/GlobalFishingWatch/viirs-footprint</p>
</section>
<section id="key-tables-3" class="level2" data-number="42.2">
<h2 data-number="42.2" class="anchored" data-anchor-id="key-tables-3"><span class="header-section-number">42.2</span> Key tables</h2>
<p>Current version</p>
<ul>
<li><code>scratch_masaki.viirs_footprint_granule_v20210208</code></li>
</ul>
<p>Older version</p>
<p>non</p>
</section>
</section>
<section id="data-descriptions-2" class="level1" data-number="43">
<h1 data-number="43"><span class="header-section-number">43</span> Data descriptions</h1>
<p>Each record of this table can be distinguished by <code>GranuleID</code> and a single record (granule) represents 6 minutes time window of VIIRS scan. The shape of the granule is contained in the <code>wkt</code> column (Well Known Text format). The <code>DayNightFlag</code> contains the information on whether the granule was scanned at night (<code>N</code>), day (<code>D</code>), or day/night boundary (<code>B</code>), and VIIRS boat detection only present in <code>N</code> and <code>B</code>.</p>
<ul>
<li><code>GranuleID</code> : Unique id for each records (granules)</li>
<li><code>StartDateTime</code> : Start datetime of this granule.</li>
<li><code>MidDateTime</code> : Median datetime of this granule (StartDateTime + 3 minutes).</li>
<li><code>EndDateTime</code> : End datetime of this granule (StartDateTime + 6 minutes).</li>
<li><code>date</code> : Date at StartDateTime</li>
<li><code>OrbitNumber</code> : <code>OrbitNumber</code> of this granule</li>
<li><code>DayNightFlag</code> : day/night information of this granule, night (<code>N</code>), day (<code>D</code>) or day/night boundary (<code>B</code>).</li>
<li><code>wkt</code> : The shape of this granule in WKT format.</li>
<li><code>NorthBoundingCoord</code> : North bound latitude of this granule</li>
<li><code>SouthBoundingCoord</code> : South bound latitude of this granule</li>
<li><code>EastBoundingCoord</code> : East bound longitude of this granule</li>
<li><code>WestBoundingCoord</code> : West bound longitude of this granule</li>
<li><code>GRingLongitude1</code> : Longitude of vertex_1 of this granule</li>
<li><code>GRingLongitude2</code> : Longitude of vertex_2 of this granule</li>
<li><code>GRingLongitude3</code> : Longitude of vertex_3 of this granule</li>
<li><code>GRingLongitude4</code> : Longitude of vertex_4 of this granule</li>
<li><code>GRingLatitude1</code> : Latitude of vertex_1 of this granule</li>
<li><code>GRingLatitude2</code> : Latitude of vertex_2 of this granule</li>
<li><code>GRingLatitude3</code> : Latitude of vertex_3 of this granule</li>
<li><code>GRingLatitude4</code> : Latitude of vertex_4 of this granule</li>
</ul>
<p>The <code>wkt</code> was created by connecting four GRing vertices using great circle line.</p>
</section>
<section id="caveats-known-issues-3" class="level1" data-number="44">
<h1 data-number="44"><span class="header-section-number">44</span> Caveats &amp; Known Issues</h1>
</section>
<section id="example-queries-3" class="level1" data-number="45">
<h1 data-number="45"><span class="header-section-number">45</span> Example queries</h1>
</section>
<section id="related-tables-3" class="level1" data-number="46">
<h1 data-number="46"><span class="header-section-number">46</span> Related tables</h1>
</section>
<section id="join-with-viirs-table" class="level1" data-number="47">
<h1 data-number="47"><span class="header-section-number">47</span> Join with VIIRS table</h1>
<div class="sourceCode" id="cb3"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> TEMP <span class="kw">FUNCTION</span> start_date() <span class="kw">AS</span> (<span class="dt">DATE</span>(<span class="st">'2020-01-01'</span>));</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> TEMP <span class="kw">FUNCTION</span> end_date() <span class="kw">AS</span> (<span class="dt">DATE</span>(<span class="st">'2020-01-02'</span>));</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a># <span class="kw">Add</span> VIIRS information <span class="kw">to</span> <span class="kw">the</span> VIIRS<span class="op">-</span>AIS matching <span class="kw">table</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span> </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a># VIIRS<span class="op">-</span>AIS matching <span class="kw">table</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>viirs_matching <span class="kw">AS</span> (</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span>  </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    `world<span class="op">-</span>fishing<span class="op">-</span><span class="fl">827.</span>pipe_production_v20201001.proto_matches_raw_vbd_global_3top_v20210514`</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>      <span class="dt">DATE</span>(_PARTITIONTIME) <span class="kw">BETWEEN</span> start_date() <span class="kw">AND</span> end_date()</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a># VIIRS <span class="kw">table</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>viirs <span class="kw">AS</span> (</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">concat</span>(<span class="fu">cast</span>(Date_Mscan <span class="kw">as</span> string),<span class="fu">concat</span>(<span class="fu">cast</span>(Lat_DNB <span class="kw">as</span> string),<span class="fu">cast</span>(Lon_DNB <span class="kw">as</span> string))) <span class="kw">as</span> detect_id,</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    `world<span class="op">-</span>fishing<span class="op">-</span><span class="fl">827.</span>pipe_viirs_production_v20220112.raw_vbd_global`</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>      QF_Detect <span class="kw">IN</span> (<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">10</span>)</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>      <span class="kw">AND</span> <span class="dt">DATE</span>(Date_Mscan) <span class="kw">BETWEEN</span> start_date() <span class="kw">AND</span> end_date()</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a># <span class="fu">Extract</span> detection <span class="kw">only</span> <span class="kw">from</span> smallest zenith orbits <span class="cf">for</span> <span class="kw">each</span> grid <span class="kw">and</span> <span class="dt">day</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>  <span class="op">*</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>  viirs_matching a</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  <span class="kw">left</span> <span class="kw">join</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>  viirs b</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>  <span class="kw">using</span>(detect_id)</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a><span class="kw">limit</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="viirs-noise-filter" class="level1" data-number="48">
<h1 data-number="48"><span class="header-section-number">48</span> VIIRS noise filter</h1>
<section id="example-query-2" class="level2" data-number="48.1">
<h2 data-number="48.1" class="anchored" data-anchor-id="example-query-2"><span class="header-section-number">48.1</span> Example query</h2>
<p>VIIRS contains many false detections, especially around South America. The example query linked below reduces the noise in South America. (but it may eliminate some prat of true detection as well as South Atlantic Anomaly)</p>
<p><a href="https://github.com/GlobalFishingWatch/viirs-noise-filter/blob/main/code/get_viirs_without_noise.sql">Example query</a></p>
<p>The filter basically adopts QF1,2,3,10 for outside of South America, while adopting some portion of QF1,2,3,5,7,10 based on the value of <code>Rad_DNB</code> and <code>SHI</code>.</p>
</section>
<section id="repository-3" class="level2" data-number="48.2">
<h2 data-number="48.2" class="anchored" data-anchor-id="repository-3"><span class="header-section-number">48.2</span> Repository</h2>
<p>The filter was developed in the repository <a href="https://github.com/GlobalFishingWatch/viirs-noise-filter">viirs-noise-filter</a>.</p>
<p>You can see the visualization results we used to develop that filter in the link below.</p>
<p>https://github.com/GlobalFishingWatch/viirs-noise-filter/blob/main/rendered_output/01_develop_viirs_noise_filter.md</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../files/s2-vessel-detections.html" class="pagination-link" aria-label="Sentinel-2 Vessel Detections">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Sentinel-2 Vessel Detections</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../files/country-codes.html" class="pagination-link" aria-label="Country Codes">
        <span class="nav-page-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Country Codes</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/GlobalFishingWatch/GFW_technical_documentation/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>