# (PART) Big Query {-} 

# Big Query datasets

GFW data is stored as BigQuery tables and organized in a handful of key datasets. These datasets contain the automated output of GFW's data pipelines as well as manually generated tables from development and research projects.

## Staging Process (2021 Updates)

**Description:** In an effort to delineate new versions of datasets with those that are used in production we are currently developing a new staging process.
** 

**Details:** The staging process includes the following:

 1. **Proof-of-Concept data**: Staging dataset for new research ideas
 * Internal only and selected research partners
 * One-off or manually updated tables
 * Manual QA

 2. **Prototype data**: Staging dataset for new research ideas
 * Intermediate and Prototype tables
 * Automated data runs (updated daily)
 * Semi-automated QA
 * Prototype tables should use convention of ‘proto_’
 * Can be used by researchers and analysts but proceed knowing that although QA'd all bugs may not have been solved
 * Basic documentation will exist for these datasets

 3. **Production data**: Staging dataset for new research ideas
 * Production level ready datasets
 * Public/research partners
 * Automated_QA
 * When proto_ tables have been used and QA'd for a given period of time, have finalized documentation, and automated QA metrics they will 
   move to 'production' data

Note: This is an evolving process, but is noted in the wiki currently because we are releasing a series of updates to the AIS event datasets and some are considered 'proto type data' and therefore everyone should be aware that these tables may be used but are NOT considered 'production' level ready.
 

## AIS PIPE-3

The dataset structure was entirely revamped in PIPE-3 and simplified by generating all AIS tables in two datasets.

### `pipe_ais_v3_internal`

+ **Description:** This dataset contains all intermediate tables that are generated by the AIS pipeline. These tables are used to generate the final tables in `pipe_ais_v3_published`. The tables in this dataset are not intended to be shared outside of GFW and usage within GFW should be limited to those who are working on the pipeline.

+ **When to use:** Only use this dataset if you are working on the AIS pipeline, e.g. as a researcher or data engineer. The intermediate tables in this dataset can also be used for debugging purposes.

### `pipe_ais_v3_published`

+ **Description:** This dataset contains the final output from the AIS pipeline. The tables in this dataset are intended to be shared with GFW partners and the public.

+ **When to use:** This dataset is the primary dataset to use for analysis by GFW staff and external users.

## Non-AIS Pipelines

Besides AIS, we have a number of other pipelines that currently follow the same structure as the AIS pipeline:

+ Sentinel-1: `pipe_sar_v1_internal` and `pipe_sar_v1_published`
+ Sentinel-2: TBD (currently under development)
+ VMS: `pipe_vms_v3_internal` and `pipe_vms_v3_published`


## Development Datasets

### `gfw_research`

+ **Description:**  This dataset includes streamlined versions of the AIS tables in `pipe_production_vYYYYMMDD`, as well as an additional AIS table subset to only include fishing vessels; vessel info tables that combine identity information from `vessel_database` with AIS activity information from `pipe_production_vYYYYMMDD`; derived data products (encounters, loitering, ports, etc.) that are not yet fully automated; and various reference tables important for analysis (e.g. EEZ info, flags of convenience, country codes, etc.). The versions of the pipeline AIS tables in `gfw_research` have been thinned (only 1 point per minute) and further processed to include additional info relevant for analysis (e.g. hours and regions). 

+ **When to use:** This dataset is the primary dataset to use for research and analysis. The streamlined AIS tables are smaller and cheaper to query than those in `pipe_production_vYYYYMMDD` and the vessel info tables include important activity data not available in `vessel_database`

### `gfw_research_precursors`

TODO

### `scratch_[GFW_USERNAME]_tll[x]`
+ **Description:** Each GFW user has their own "scratch" dataset for development and testing. Tables in these datasets get deleted after a certain amount of days so for long-term projects you should create new datasets.



## Other Relevant Datasets

### `pipe_ais_sources_v20201001` and `pipe_ais_sources_v20220628`

These two datasets contain the raw AIS data that is used to run any AIS pipeline. The only processing that has been applied to tables in these datasets is:
1. parsing (decoding) of raw nmea data; and
2. normalization of the data to a common schema as well as deduplication of messages from different data providers.

Historically, they have not been part of the AIS pipeline itself since they are usually not being regenerated upon a new AIS pipeline release.

### `anchorages`

The [anchorages pipeline](https://github.com/GlobalFishingWatch/anchorages_pipeline) generates tables based on AIS data as well as static datasources of anchorages and their names. This dataset is used across different pipelines, like AIS and VMS.

### `pipe_static`

This dataset contains static tables that are being generated based on static data sources. This data is being used across most pipelines to add geographical information like distance from shore or depth. WARNING: for some tables it is unclear what the underlying data source is!

### `pipe_regions_layers`

This dataset contains region lookup tables that define the shape of each region. Those are occasionally updated due to corrections, regional disputes, and new or shifting regions. Like the static tables, this dataset is used across most pipelines to provide information in which regions a certain coordinate is located.

### `tech_dq_monitoring` and `tech_anomaly_detection`

These two datasets contain tables that are used to monitor the data quality of all GFW data. The data may be used for debugging or adhoc analyses but since their primary purpose is to power dashboards and anomaly alerts the data does not follow the same reliability standards we have for other pipelines. Therefore, data might be outdated or unavailable at times.